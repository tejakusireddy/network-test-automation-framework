## Spine2 — Route Reflector
## AS 65000 | Loopback: 10.255.0.2/32
## OSPF underlay + iBGP overlay (RR) + EVPN address family

system {
    host-name spine2;
    root-authentication {
        encrypted-password "$6$abc123$fakehash";
    }
    login {
        user admin {
            class super-user;
            authentication {
                encrypted-password "$6$abc123$fakehash";
            }
        }
    }
    services {
        ssh;
        netconf {
            ssh;
        }
    }
    syslog {
        file messages {
            any notice;
            authorization info;
        }
    }
}

interfaces {
    lo0 {
        description "Loopback — spine2 router-id";
        unit 0 {
            family inet {
                address 10.255.0.2/32;
            }
        }
    }
    eth1 {
        description "to-leaf1 et-0/0/0";
        unit 0 {
            family inet {
                address 10.0.2.0/31;
            }
        }
    }
    eth2 {
        description "to-leaf2 et-0/0/1";
        unit 0 {
            family inet {
                address 10.0.2.2/31;
            }
        }
    }
    eth3 {
        description "to-leaf3 et-0/0/2";
        unit 0 {
            family inet {
                address 10.0.2.4/31;
            }
        }
    }
    eth4 {
        description "to-leaf4 et-0/0/3";
        unit 0 {
            family inet {
                address 10.0.2.6/31;
            }
        }
    }
}

routing-options {
    router-id 10.255.0.2;
    autonomous-system 65000;
    forwarding-table {
        export load-balance;
    }
}

protocols {
    ospf {
        area 0.0.0.0 {
            interface lo0.0 {
                passive;
            }
            interface eth1.0 {
                interface-type p2p;
                bfd-liveness-detection {
                    minimum-interval 300;
                    multiplier 3;
                }
            }
            interface eth2.0 {
                interface-type p2p;
                bfd-liveness-detection {
                    minimum-interval 300;
                    multiplier 3;
                }
            }
            interface eth3.0 {
                interface-type p2p;
                bfd-liveness-detection {
                    minimum-interval 300;
                    multiplier 3;
                }
            }
            interface eth4.0 {
                interface-type p2p;
                bfd-liveness-detection {
                    minimum-interval 300;
                    multiplier 3;
                }
            }
        }
    }
    bgp {
        group OVERLAY-RR-CLIENTS {
            type internal;
            local-address 10.255.0.2;
            cluster 10.255.0.2;
            family evpn {
                signaling;
            }
            bfd-liveness-detection {
                minimum-interval 300;
                multiplier 3;
            }
            neighbor 10.255.0.3 {
                description "leaf1";
            }
            neighbor 10.255.0.4 {
                description "leaf2";
            }
            neighbor 10.255.0.5 {
                description "leaf3";
            }
            neighbor 10.255.0.6 {
                description "leaf4";
            }
        }
        group OVERLAY-RR-MESH {
            type internal;
            local-address 10.255.0.2;
            family evpn {
                signaling;
            }
            neighbor 10.255.0.1 {
                description "spine1";
            }
        }
    }
    lldp {
        interface all;
    }
}

policy-options {
    policy-statement load-balance {
        then {
            load-balance per-packet;
        }
    }
}
