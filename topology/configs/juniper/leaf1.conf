## Leaf1 — EVPN-VXLAN leaf (rack-1, position A)
## AS 65000 | Loopback: 10.255.0.3/32 | VTEP: 10.255.0.3

system {
    host-name leaf1;
    root-authentication {
        encrypted-password "$6$abc123$fakehash";
    }
    login {
        user admin {
            class super-user;
            authentication {
                encrypted-password "$6$abc123$fakehash";
            }
        }
    }
    services {
        ssh;
        netconf {
            ssh;
        }
    }
    syslog {
        file messages {
            any notice;
            authorization info;
        }
    }
}

interfaces {
    lo0 {
        description "Loopback — leaf1 router-id / VTEP source";
        unit 0 {
            family inet {
                address 10.255.0.3/32;
            }
        }
    }
    eth1 {
        description "to-spine1";
        unit 0 {
            family inet {
                address 10.0.1.1/31;
            }
        }
    }
    eth2 {
        description "to-spine2";
        unit 0 {
            family inet {
                address 10.0.2.1/31;
            }
        }
    }
    irb {
        unit 100 {
            description "VLAN 100 — Tenant-A Servers";
            family inet {
                address 192.168.100.1/24;
            }
        }
        unit 200 {
            description "VLAN 200 — Tenant-B Servers";
            family inet {
                address 192.168.200.1/24;
            }
        }
    }
}

routing-options {
    router-id 10.255.0.3;
    autonomous-system 65000;
    forwarding-table {
        export load-balance;
    }
}

protocols {
    ospf {
        area 0.0.0.0 {
            interface lo0.0 {
                passive;
            }
            interface eth1.0 {
                interface-type p2p;
                bfd-liveness-detection {
                    minimum-interval 300;
                    multiplier 3;
                }
            }
            interface eth2.0 {
                interface-type p2p;
                bfd-liveness-detection {
                    minimum-interval 300;
                    multiplier 3;
                }
            }
        }
    }
    bgp {
        group OVERLAY-TO-RR {
            type internal;
            local-address 10.255.0.3;
            family evpn {
                signaling;
            }
            bfd-liveness-detection {
                minimum-interval 300;
                multiplier 3;
            }
            neighbor 10.255.0.1 {
                description "spine1-rr";
            }
            neighbor 10.255.0.2 {
                description "spine2-rr";
            }
        }
    }
    evpn {
        encapsulation vxlan;
        extended-vni-list [ 10100 10200 ];
    }
    lldp {
        interface all;
    }
}

switch-options {
    vtep-source-interface lo0.0;
    route-distinguisher 10.255.0.3:1;
    vrf-target target:65000:1;
}

vlans {
    VLAN100 {
        vlan-id 100;
        l3-interface irb.100;
        vxlan {
            vni 10100;
        }
    }
    VLAN200 {
        vlan-id 200;
        l3-interface irb.200;
        vxlan {
            vni 10200;
        }
    }
}

policy-options {
    policy-statement load-balance {
        then {
            load-balance per-packet;
        }
    }
}
